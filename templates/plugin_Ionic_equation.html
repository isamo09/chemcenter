{% extends "base.html" %}

{% block title %}Решатель ионных уравнений - {{ config.site_title }}{% endblock %}

{% block extra_css %}
<style>
    .plugin-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }

    .plugin-header {
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: white;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .plugin-header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .back-button {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        padding: 10px 20px;
        border-radius: 6px;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: background 0.3s;
    }

    .back-button:hover {
        background: rgba(255, 255, 255, 0.3);
    }

    .plugin-title-section {
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .plugin-header h1 {
        font-size: 28px;
        font-weight: 700;
    }

    .input-section {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    .input-section label {
        display: block;
        margin-bottom: 10px;
        font-weight: 600;
        color: var(--text-color);
    }

    .input-section input {
        width: 100%;
        padding: 14px 18px;
        border: 2px solid var(--border-color);
        border-radius: 8px;
        font-size: 16px;
        margin-bottom: 15px;
    }

    .input-section button {
        background: var(--accent-color);
        color: white;
        border: none;
        padding: 14px 30px;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
    }

    .examples {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 30px;
    }

    .examples button {
        background: var(--secondary-color);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        margin: 5px;
        cursor: pointer;
    }

    .results {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 30px;
        margin-top: 30px;
    }

    .error {
        color: #e74c3c;
        padding: 15px;
        background: rgba(231, 76, 60, 0.1);
        border-radius: 8px;
        margin-bottom: 15px;
    }
</style>
{% endblock %}

{% block content %}
<div class="plugin-container">
    <header class="plugin-header">
        <div class="plugin-header-content">
            <a href="/" class="back-button">
                <i class="fas fa-arrow-left"></i> Назад
            </a>
            <div class="plugin-title-section">
                <img src="{{ config.site_logo_dark }}" class="header-logo plugin-logo" alt="logo">
                <h1><i class="fas fa-flask"></i> Решатель ионных уравнений</h1>
            </div>
        </div>
    </header>

    <div class="input-section">
        <label>Введите уравнение:</label>
        <input type="text" id="equation-input" placeholder="NaCl + AgNO3" class="form-control">
        <button onclick="solveEquation()" class="btn-primary">
            <i class="fas fa-calculator"></i> Решить
        </button>
    </div>
    
    <div class="examples">
        <strong>Примеры:</strong>
        <button onclick="setExample('NaCl + AgNO3')">NaCl + AgNO3</button>
        <button onclick="setExample('HCl + NaOH')">HCl + NaOH</button>
        <button onclick="setExample('BaCl2 + Na2SO4')">BaCl2 + Na2SO4</button>
    </div>
    
    <div id="results" class="results" style="display: none;">
        <!-- Результаты будут здесь -->
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function setExample(equation) {
    document.getElementById('equation-input').value = equation;
}

async function solveEquation() {
    const equation = document.getElementById('equation-input').value;
    if (!equation) {
        alert('Введите уравнение');
        return;
    }
    
    const resultsDiv = document.getElementById('results');
    resultsDiv.style.display = 'block';
    resultsDiv.innerHTML = '<p>Рассчитываю...</p>';
    
    try {
        const response = await fetch('/api/plugin/Ionic_equation', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ equation: equation })
        });
        
        const data = await response.json();
        displayResults(data);
    } catch (error) {
        displayResults({error: true, message: 'Ошибка при расчете: ' + error.message});
    }
}

function displayResults(data) {
    const resultsDiv = document.getElementById('results');
    
    if (data.error) {
        resultsDiv.innerHTML = `<div class="error">${data.message}</div>`;
    } else {
        resultsDiv.innerHTML = `
            <h3>Результаты:</h3>
            <div class="equation"><strong>Молекулярное уравнение:</strong> ${data.molecular_equation || data.original_equation || '—'}</div>
            <div class="ionic"><strong>Полное ионное:</strong> ${data.total_ionic_equation || '—'}</div>
            <div class="ionic"><strong>Сокращенное:</strong> ${data.net_ionic_equation || '—'}</div>
            <div class="type"><strong>Тип:</strong> ${data.reaction_type || '—'}</div>
            ${data.precipitates && data.precipitates.length > 0 ? `<div class="precipitate"><strong>Осадок:</strong> ${data.precipitates.join(', ')}</div>` : ''}
            ${data.notes && data.notes.length > 0 ? `<div class="notes"><strong>Примечания:</strong><ul>${data.notes.map(n => `<li>${n}</li>`).join('')}</ul></div>` : ''}
        `;
    }
    
    resultsDiv.style.display = 'block';
}
</script>
{% endblock %}
