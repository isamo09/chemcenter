{% extends "base.html" %}

{% block title %}Решатель ионных уравнений - {{ config.site_title }}{% endblock %}

{% block header %}
<header class="header">
    <div class="header-content">
        <div class="logo-section">
            <a href="/" class="back-link" style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-arrow-left"></i>
                <img src="{{ config.site_logo_dark if config and config.site_logo_dark else '/static/images/logo-dark.png' }}" alt="Логотип {{ config.site_title }}" class="header-logo">
            </a>
            <h1 class="site-title">Ионные уравнения</h1>
        </div>
        <nav class="header-nav">
            <button class="theme-toggle" id="themeToggle" title="Переключить тему" aria-label="Переключить тему">
                <i class="fas fa-moon" aria-hidden="true"></i>
            </button>
            <a href="/" class="admin-link" aria-label="На главную">
                <i class="fas fa-home" aria-hidden="true"></i> <span>Главная</span>
            </a>
        </nav>
    </div>
</header>
{% endblock %}

{% block extra_css %}
<style>
    .input-section {
        background: var(--surface);
        border-radius: 12px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    .input-section input {
        width: 100%;
        padding: 14px 18px;
        border: 2px solid var(--border);
        border-radius: 8px;
        font-size: 16px;
        background: var(--background);
        color: var(--text-primary);
        transition: border-color 0.3s;
    }

    .input-section input:focus {
        outline: none;
        border-color: var(--accent);
    }

    .results-section {
        background: var(--surface);
        border-radius: 12px;
        padding: 30px;
        margin-top: 30px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        display: none;
    }

    .equation, .ionic, .type, .precipitate {
        margin-bottom: 15px;
        padding: 15px;
        background: var(--background);
        border-radius: 8px;
        border-left: 4px solid var(--accent);
    }

    .error {
        background: #fee;
        color: #c33;
        padding: 20px;
        border-radius: 8px;
        border-left: 4px solid #c33;
    }

    .notes {
        margin-top: 15px;
        padding: 15px;
        background: #fff3cd;
        border-radius: 8px;
        border-left: 4px solid #ffc107;
    }

    .notes ul {
        margin: 10px 0 0 0;
        padding-left: 20px;
    }
</style>
{% endblock %}

{% block content %}
<div class="plugin-container">
    <main class="main-content">
        <div class="input-section">
            <h2>Решатель ионных уравнений</h2>
            <form id="ionEquationForm">
                <div class="form-group">
                    <label for="equation">Введите уравнение:</label>
                    <input type="text" id="equation" name="equation" 
                           placeholder="Например: AgNO3 + NaCl → AgCl + NaNO3" 
                           value="AgNO3 + NaCl → AgCl + NaNO3" required>
                </div>
                <button type="submit" class="btn">
                    <i class="fas fa-calculator"></i> Решить
                </button>
            </form>
        </div>

        <div id="results" class="results-section">
            <!-- Результаты будут отображены здесь -->
        </div>
    </main>
</div>

<script>
document.getElementById('ionEquationForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const equation = document.getElementById('equation').value;
    const resultsDiv = document.getElementById('results');
    
    try {
        const response = await fetch('/api/Ionic_equation/solve', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ equation: equation })
        });
        
        const data = await response.json();
        displayResults(data);
    } catch (error) {
        console.error('Error:', error);
        displayResults({ error: true, message: 'Произошла ошибка при отправке запроса' });
    }
});

function displayResults(data) {
    const resultsDiv = document.getElementById('results');
    
    if (data.error) {
        resultsDiv.innerHTML = `<div class="error">${data.message}</div>`;
    } else {
        resultsDiv.innerHTML = `
            <h3>Результаты:</h3>
            <div class="equation"><strong>Молекулярное уравнение:</strong> ${data.molecular_equation || data.original_equation || '—'}</div>
            <div class="ionic"><strong>Полное ионное:</strong> ${data.total_ionic_equation || '—'}</div>
            <div class="ionic"><strong>Сокращенное:</strong> ${data.net_ionic_equation || '—'}</div>
            <div class="type"><strong>Тип:</strong> ${data.reaction_type || '—'}</div>
            ${data.precipitates && data.precipitates.length > 0 ? `<div class="precipitate"><strong>Осадок:</strong> ${data.precipitates.join(', ')}</div>` : ''}
            ${data.notes && data.notes.length > 0 ? `<div class="notes"><strong>Примечания:</strong><ul>${data.notes.map(n => `<li>${n}</li>`).join('')}</ul></div>` : ''}
        `;
    }
    
    resultsDiv.style.display = 'block';
}
</script>
{% endblock %}
