{% extends "base.html" %}

{% block title %}Электрохимический ряд напряжений - {{ config.site_title }}{% endblock %}

{% block extra_css %}
<style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-bg: #f5f7fa;
            --dark-bg: #1a1a2e;
            --card-light: #ffffff;
            --card-dark: #2d3047;
            --text-light: #333333;
            --text-dark: #f0f0f0;
            --border-light: #dddddd;
            --border-dark: #444444;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
        }

        [data-theme="dark"] {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --accent-color: #e74c3c;
            --light-bg: #1a1a2e;
            --dark-bg: #0d0d15;
            --card-light: #2d3047;
            --card-dark: #252736;
            --text-light: #f0f0f0;
            --text-dark: #e0e0e0;
            --border-light: #444444;
            --border-dark: #555555;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light-bg);
            color: var(--text-light);
            min-height: 100vh;
            transition: all 0.3s ease;
        }

        .plugin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .plugin-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .plugin-header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .back-button {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.3s;
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .plugin-title-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-logo {
            height: 50px;
            width: auto;
        }

        .plugin-header h1 {
            font-size: 28px;
            font-weight: 700;
        }

        .theme-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(15deg);
        }

        .main-content {
            background-color: var(--card-light);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .info-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            color: var(--text-light);
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 5px solid var(--secondary-color);
        }

        [data-theme="dark"] .info-section {
            background: linear-gradient(135deg, #2d3047, #252736);
        }

        .info-section h2 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 24px;
        }

        .info-section p {
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .voltage-series {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .metal-card {
            background-color: var(--card-light);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            border-top: 4px solid;
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
            overflow: hidden;
        }

        .metal-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .metal-card.active {
            border-color: var(--success-color);
        }

        .metal-card.noble {
            border-color: #9b59b6;
        }

        .metal-card.medium {
            border-color: var(--warning-color);
        }

        .metal-card.active {
            border-color: var(--danger-color);
        }

        .metal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .metal-name {
            font-size: 22px;
            font-weight: 700;
            color: var(--primary-color);
        }

        .metal-symbol {
            background-color: var(--secondary-color);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }

        .metal-property {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px dashed var(--border-light);
        }

        .property-name {
            font-weight: 600;
            color: var(--primary-color);
        }

        .property-value {
            font-weight: 700;
        }

        .property-value.positive {
            color: var(--danger-color);
        }

        .property-value.negative {
            color: var(--success-color);
        }

        .reactivity-indicator {
            height: 8px;
            background: linear-gradient(to right, #27ae60, #f39c12, #e74c3c);
            border-radius: 4px;
            margin-top: 15px;
            position: relative;
        }

        .reactivity-marker {
            position: absolute;
            top: -5px;
            width: 3px;
            height: 18px;
            background-color: var(--primary-color);
        }

        .comparison-section {
            margin-top: 40px;
        }

        .comparison-header {
            font-size: 22px;
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--secondary-color);
        }

        .comparison-form {
            background-color: var(--light-bg);
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border-light);
            border-radius: 6px;
            font-size: 16px;
            transition: border 0.3s;
            background-color: var(--card-light);
            color: var(--text-light);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--secondary-color);
        }

        .btn-primary {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .result-section {
            background-color: var(--card-light);
            border-radius: 10px;
            padding: 25px;
            margin-top: 30px;
            border-left: 5px solid var(--accent-color);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .result-section.hidden {
            display: none;
        }

        .result-header {
            display: flex;
            gap: 30px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .result-item {
            background-color: var(--light-bg);
            padding: 15px 25px;
            border-radius: 8px;
            min-width: 200px;
        }

        .result-item .label {
            font-size: 14px;
            color: #777;
            margin-bottom: 5px;
        }

        [data-theme="dark"] .result-item .label {
            color: #aaa;
        }

        .result-item .value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
        }

        .reaction-display {
            background-color: var(--light-bg);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            font-family: 'Courier New', monospace;
            font-size: 20px;
            text-align: center;
            border: 1px dashed var(--border-light);
        }

        .explanation-box {
            background-color: var(--light-bg);
            padding: 25px;
            border-radius: 8px;
            margin-top: 25px;
        }

        .explanation-header {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .explanation-content {
            line-height: 1.7;
        }

        .error-section {
            background-color: rgba(231, 76, 60, 0.1);
            border: 1px solid var(--danger-color);
            color: var(--danger-color);
            padding: 25px;
            border-radius: 10px;
            margin-top: 30px;
        }

        .error-section.hidden {
            display: none;
        }

        .error-section h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .footnote {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--border-light);
            color: #777;
            font-size: 14px;
            line-height: 1.6;
        }

        [data-theme="dark"] .footnote {
            color: #aaa;
        }

        @media (max-width: 768px) {
            .plugin-header-content {
                flex-direction: column;
                gap: 20px;
            }

            .voltage-series {
                grid-template-columns: 1fr;
            }

            .result-header {
                flex-direction: column;
                gap: 15px;
            }

            .result-item {
                min-width: 100%;
            }
        }
    </style>
{% endblock %}

{% block content %}
<div class="plugin-container">
    <header class="plugin-header">
        <div class="plugin-header-content">
            <a href="/" class="back-button">
                <i class="fas fa-arrow-left"></i> Назад
            </a>
            <div class="plugin-title-section">
                <img src="{{ config.site_logo_dark }}" class="header-logo plugin-logo" alt="logo">
                <h1><i class="fas fa-bolt"></i> Электрохимический ряд напряжений</h1>
            </div>
            <button id="themeToggle" class="theme-toggle"><i class="fas fa-moon"></i></button>
        </div>
    </header>

        <main class="main-content">
            <div class="info-section">
                <h2>Ряд активности металлов</h2>
                <p>Электрохимический ряд напряжений металлов — последовательность, в которой металлы расположены в порядке увеличения их стандартных электродных потенциалов. Чем левее в ряду, тем металл активнее (сильнее восстановитель).</p>
                <p><strong>Правило:</strong> Металл, стоящий левее, вытесняет металл, стоящий правее, из растворов его солей.</p>
            </div>

            <div class="voltage-series" id="seriesContainer">
                <!-- Металлы будут добавлены через JavaScript -->
            </div>

            <div class="comparison-section">
                <h3 class="comparison-header"><i class="fas fa-balance-scale"></i> Сравнение активности металлов</h3>

                <div class="comparison-form">
                    <form id="comparisonForm">
                        <div class="form-group">
                            <label>Выберите первый металл:</label>
                            <select id="metal1" class="form-control" required>
                                <option value="">-- Выберите металл --</option>
                                <!-- Опции будут добавлены через JS -->
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Выберите второй металл:</label>
                            <select id="metal2" class="form-control" required>
                                <option value="">-- Выберите металл --</option>
                                <!-- Опции будут добавлены через JS -->
                            </select>
                        </div>

                        <button type="submit" class="btn-primary">
                            <i class="fas fa-calculator"></i> Сравнить активность
                        </button>
                    </form>
                </div>

                <div id="comparisonResult" class="result-section hidden">
                    <h3><i class="fas fa-chart-bar"></i> Результат сравнения</h3>

                    <div class="result-header">
                        <div class="result-item">
                            <div class="label">Более активный металл:</div>
                            <div id="moreActive" class="value"></div>
                        </div>
                        <div class="result-item">
                            <div class="label">Разность потенциалов:</div>
                            <div id="potentialDiff" class="value"></div>
                        </div>
                        <div class="result-item">
                            <div class="label">Реакция возможна:</div>
                            <div id="reactionPossible" class="value"></div>
                        </div>
                    </div>

                    <div class="reaction-display" id="reactionEquation">
                        <!-- Уравнение реакции -->
                    </div>

                    <div class="explanation-box">
                        <div class="explanation-header">
                            <i class="fas fa-lightbulb"></i> Объяснение
                        </div>
                        <div class="explanation-content" id="reactionExplanation">
                            <!-- Объяснение -->
                        </div>
                    </div>
                </div>

                <div id="comparisonError" class="error-section hidden">
                    <h3><i class="fas fa-exclamation-circle"></i> Ошибка</h3>
                    <p id="errorMessage"></p>
                </div>
            </div>

            <div class="footnote">
                <p><strong>Примечание:</strong> Значения стандартных электродных потенциалов даны относительно стандартного водородного электрода при 25°C. Ряд может незначительно меняться в зависимости от условий (концентрации, температуры, pH).</p>
            </div>
        </main>
    </div>

    <script>
        // Данные по металлам
        const metals = [
            { symbol: "Li", name: "Литий", potential: -3.04, reactivity: "очень высокая", color: "#e74c3c", type: "active" },
            { symbol: "K", name: "Калий", potential: -2.93, reactivity: "очень высокая", color: "#e74c3c", type: "active" },
            { symbol: "Ca", name: "Кальций", potential: -2.87, reactivity: "очень высокая", color: "#e74c3c", type: "active" },
            { symbol: "Na", name: "Натрий", potential: -2.71, reactivity: "очень высокая", color: "#e74c3c", type: "active" },
            { symbol: "Mg", name: "Магний", potential: -2.37, reactivity: "высокая", color: "#f39c12", type: "medium" },
            { symbol: "Al", name: "Алюминий", potential: -1.66, reactivity: "высокая", color: "#f39c12", type: "medium" },
            { symbol: "Zn", name: "Цинк", potential: -0.76, reactivity: "средняя", color: "#f39c12", type: "medium" },
            { symbol: "Fe", name: "Железо", potential: -0.44, reactivity: "средняя", color: "#f39c12", type: "medium" },
            { symbol: "Ni", name: "Никель", potential: -0.25, reactivity: "средняя", color: "#f39c12", type: "medium" },
            { symbol: "Sn", name: "Олово", potential: -0.14, reactivity: "слабая", color: "#3498db", type: "noble" },
            { symbol: "Pb", name: "Свинец", potential: -0.13, reactivity: "слабая", color: "#3498db", type: "noble" },
            { symbol: "H", name: "Водород", potential: 0.00, reactivity: "эталон", color: "#9b59b6", type: "reference" },
            { symbol: "Cu", name: "Медь", potential: +0.34, reactivity: "слабая", color: "#3498db", type: "noble" },
            { symbol: "Ag", name: "Серебро", potential: +0.80, reactivity: "очень слабая", color: "#3498db", type: "noble" },
            { symbol: "Pt", name: "Платина", potential: +1.20, reactivity: "очень слабая", color: "#3498db", type: "noble" },
            { symbol: "Au", name: "Золото", potential: +1.50, reactivity: "очень слабая", color: "#3498db", type: "noble" }
        ];

        // Сортировка по потенциалу (от меньшего к большему)
        metals.sort((a, b) => a.potential - b.potential);

        // Инициализация темы
        document.addEventListener("DOMContentLoaded", () => {
            initTheme();
            renderMetals();
            initComparisonForm();
        });

        function initTheme() {
            const btn = document.getElementById("themeToggle");
            const saved = localStorage.getItem("theme") || "light";
            document.documentElement.setAttribute("data-theme", saved);

            btn.innerHTML = saved === "light" ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';

            btn.addEventListener("click", () => {
                const current = document.documentElement.getAttribute("data-theme");
                const next = current === "light" ? "dark" : "light";
                document.documentElement.setAttribute("data-theme", next);
                localStorage.setItem("theme", next);
                btn.innerHTML = next === "light" ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
            });
        }

        // Отрисовка карточек металлов
        function renderMetals() {
            const container = document.getElementById("seriesContainer");
            const select1 = document.getElementById("metal1");
            const select2 = document.getElementById("metal2");

            container.innerHTML = "";
            select1.innerHTML = '<option value="">-- Выберите металл --</option>';
            select2.innerHTML = '<option value="">-- Выберите металл --</option>';

            metals.forEach((metal, index) => {
                // Карточка металла
                const card = document.createElement("div");
                card.className = `metal-card ${metal.type}`;
                card.style.borderTopColor = metal.color;

                const potentialClass = metal.potential < 0 ? "negative" : "positive";
                const potentialSign = metal.potential >= 0 ? "+" : "";

                card.innerHTML = `
                    <div class="metal-header">
                        <div class="metal-name">${metal.name}</div>
                        <div class="metal-symbol">${metal.symbol}</div>
                    </div>
                    <div class="metal-property">
                        <span class="property-name">Потенциал, В:</span>
                        <span class="property-value ${potentialClass}">${potentialSign}${metal.potential.toFixed(2)}</span>
                    </div>
                    <div class="metal-property">
                        <span class="property-name">Активность:</span>
                        <span class="property-value">${metal.reactivity}</span>
                    </div>
                    <div class="metal-property">
                        <span class="property-name">Положение в ряду:</span>
                        <span class="property-value">${index + 1}</span>
                    </div>
                    <div class="reactivity-indicator">
                        <div class="reactivity-marker" style="left: ${((metal.potential + 3.5) / 5) * 100}%"></div>
                    </div>
                `;

                container.appendChild(card);

                // Опции для выбора
                const option1 = document.createElement("option");
                option1.value = metal.symbol;
                option1.textContent = `${metal.name} (${metal.symbol}, ${potentialSign}${metal.potential.toFixed(2)} В)`;

                const option2 = option1.cloneNode(true);

                select1.appendChild(option1);
                select2.appendChild(option2);
            });
        }

        // Инициализация формы сравнения
        function initComparisonForm() {
            const form = document.getElementById("comparisonForm");
            form.addEventListener("submit", compareMetals);
        }

        // Сравнение двух металлов
        function compareMetals(e) {
            e.preventDefault();

            const metal1Symbol = document.getElementById("metal1").value;
            const metal2Symbol = document.getElementById("metal2").value;

            if (!metal1Symbol || !metal2Symbol) {
                showError("Выберите оба металла для сравнения");
                return;
            }

            if (metal1Symbol === metal2Symbol) {
                showError("Выберите разные металлы для сравнения");
                return;
            }

            const metal1 = metals.find(m => m.symbol === metal1Symbol);
            const metal2 = metals.find(m => m.symbol === metal2Symbol);

            if (!metal1 || !metal2) {
                showError("Ошибка данных металлов");
                return;
            }

            // Определение более активного металла
            const moreActive = metal1.potential < metal2.potential ? metal1 : metal2;
            const lessActive = metal1.potential < metal2.potential ? metal2 : metal1;

            // Разность потенциалов
            const diff = Math.abs(metal1.potential - metal2.potential).toFixed(2);

            // Реакция возможна, если металлы не одинаковой активности
            const reactionPossible = metal1.potential !== metal2.potential ? "Да" : "Нет";

            // Формирование уравнения реакции
            let equation = "";
            if (moreActive.potential < lessActive.potential && lessActive.symbol !== "H") {
                equation = `${moreActive.symbol} + ${lessActive.symbol}SO₄ → ${moreActive.symbol}SO₄ + ${lessActive.symbol}`;
            } else if (moreActive.potential < 0 && lessActive.symbol === "H") {
                equation = `${moreActive.symbol} + 2H⁺ → ${moreActive.symbol}²⁺ + H₂`;
            } else {
                equation = "Реакция не протекает (металл менее активен)";
            }

            // Объяснение
            let explanation = "";
            if (moreActive.potential < lessActive.potential) {
                explanation = `${moreActive.name} (${moreActive.symbol}) расположен левее в ряду напряжений, чем ${lessActive.name} (${lessActive.symbol}), поэтому он является более сильным восстановителем. `;
                explanation += `В окислительно-восстановительной реакции ${moreActive.symbol} будет окисляться, вытесняя ${lessActive.symbol} из раствора его соли. `;
                explanation += `Разность стандартных электродных потенциалов составляет ${diff} В.`;
            } else {
                explanation = `Металлы имеют одинаковую активность или ${lessActive.name} активнее ${moreActive.name}, поэтому реакция вытеснения не протекает.`;
            }

            // Отображение результатов
            document.getElementById("comparisonError").classList.add("hidden");
            document.getElementById("comparisonResult").classList.remove("hidden");

            document.getElementById("moreActive").textContent = `${moreActive.name} (${moreActive.symbol})`;
            document.getElementById("potentialDiff").textContent = `${diff} В`;
            document.getElementById("reactionPossible").textContent = reactionPossible;
            document.getElementById("reactionEquation").textContent = equation;
            document.getElementById("reactionExplanation").textContent = explanation;
        }

        function showError(message) {
            document.getElementById("comparisonResult").classList.add("hidden");
            document.getElementById("comparisonError").classList.remove("hidden");
            document.getElementById("errorMessage").textContent = message;
        }
    </script>
{% endblock %}