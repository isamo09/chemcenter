{% extends "base.html" %}

{% block title %}Углеводороды - {{ config.site_title }}{% endblock %}

{% block extra_css %}
<style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-bg: #f5f7fa;
            --dark-bg: #1a1a2e;
            --card-bg: #ffffff;
            --card-bg-dark: #2d3047;
            --text-color: #333333;
            --text-color-dark: #f0f0f0;
            --border-color: #dddddd;
            --border-color-dark: #444444;
            --muted-color: #777777;
            --muted-color-dark: #aaaaaa;
            --code-bg: #f8f9fa;
            --code-bg-dark: #2a2d3e;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --input-bg: #ffffff;
            --input-bg-dark: #2d3047;
            --table-header-bg: #f8f9fa;
            --table-header-bg-dark: #2a2d3e;
            --table-hover-bg: #f8f9fa;
            --table-hover-bg-dark: #3a3d4e;
            --alkane-color: #3498db;
            --alkene-color: #9b59b6;
            --alkyne-color: #e74c3c;
            --cyclo-color: #2ecc71;
            --arena-color: #f39c12;
        }

        [data-theme="dark"] {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --accent-color: #e74c3c;
            --light-bg: #1a1a2e;
            --dark-bg: #0d0d15;
            --card-bg: #2d3047;
            --card-bg-dark: #252736;
            --text-color: #f0f0f0;
            --text-color-dark: #e0e0e0;
            --border-color: #444444;
            --border-color-dark: #555555;
            --muted-color: #aaaaaa;
            --muted-color-dark: #cccccc;
            --code-bg: #2a2d3e;
            --code-bg-dark: #1a1d2e;
            --input-bg: #2d3047;
            --input-bg-dark: #252736;
            --table-header-bg: #2a2d3e;
            --table-header-bg-dark: #1a1d2e;
            --table-hover-bg: #3a3d4e;
            --table-hover-bg-dark: #4a4d5e;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light-bg);
            color: var(--text-color);
            min-height: 100vh;
            transition: all 0.3s ease;
        }

        .plugin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .plugin-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .plugin-header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .back-button {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.3s;
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .plugin-title-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-logo {
            height: 50px;
            width: auto;
            font-size: 32px;
        }

        .plugin-header h1 {
            font-size: 28px;
            font-weight: 700;
        }

        .theme-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(15deg);
        }

        .principle-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        @media (max-width: 992px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .info-section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            border-left: 4px solid var(--accent-color);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            grid-column: 1 / -1;
        }

        .info-section h2 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 24px;
        }

        .info-section p {
            color: var(--text-color);
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .info-section code {
            background: var(--code-bg);
            padding: 4px 8px;
            border-radius: 4px;
            font-family: monospace;
            color: var(--accent-color);
            font-weight: bold;
        }

        .form {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            height: fit-content;
        }

        .form h2 {
            color: var(--primary-color);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
            font-size: 22px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--text-color);
            font-size: 16px;
        }

        .form-control {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            background: var(--input-bg);
            color: var(--text-color);
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .formula-input {
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        .form-group small {
            display: block;
            margin-top: 8px;
            color: var(--muted-color);
            font-size: 14px;
        }

        .examples-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        @media (max-width: 768px) {
            .examples-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .example-tag {
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 6px;
            padding: 12px;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--text-color);
        }

        .example-tag:hover {
            border-color: var(--accent-color);
            background: var(--accent-color);
            color: white;
            transform: translateY(-2px);
        }

        .example-tag.active {
            border-color: var(--accent-color);
            background: var(--accent-color);
            color: white;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        .btn-primary {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 14px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
            min-width: 200px;
            justify-content: center;
        }

        .btn-primary:hover {
            background: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }

        .btn-secondary {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 14px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
            min-width: 200px;
            justify-content: center;
        }

        .btn-secondary:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(52, 152, 219, 0.2);
        }

        .result-section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            margin-top: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            grid-column: 1 / -1;
        }

        .result-section.hidden {
            display: none;
        }

        .result-section h3 {
            color: var(--primary-color);
            margin-bottom: 25px;
            font-size: 22px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }

        .equation-card {
            background: var(--code-bg);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .equation-number {
            background: var(--accent-color);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            flex-shrink: 0;
        }

        .equation-display {
            font-family: 'Courier New', monospace;
            font-size: 28px;
            color: var(--text-color);
            flex-grow: 1;
            text-align: center;
        }

        .formula-card {
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .formula-title {
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 15px;
            font-size: 16px;
        }

        .hydrocarbon-class {
            display: inline-block;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .hydrocarbon-class.alkane {
            background-color: rgba(52, 152, 219, 0.2);
            color: var(--alkane-color);
        }

        .hydrocarbon-class.alkene {
            background-color: rgba(155, 89, 182, 0.2);
            color: var(--alkene-color);
        }

        .hydrocarbon-class.alkyne {
            background-color: rgba(231, 76, 60, 0.2);
            color: var(--alkyne-color);
        }

        .hydrocarbon-class.cyclo {
            background-color: rgba(46, 204, 113, 0.2);
            color: var(--cyclo-color);
        }

        .hydrocarbon-class.arena {
            background-color: rgba(243, 156, 18, 0.2);
            color: var(--arena-color);
        }

        .result-header {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .result-item {
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
        }

        .result-item .label {
            font-size: 14px;
            color: var(--muted-color);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .result-item .value {
            font-size: 24px;
            font-weight: bold;
            color: var(--text-color);
        }

        .structure-preview {
            background: var(--code-bg);
            border-radius: 8px;
            padding: 25px;
            margin: 25px 0;
            font-family: 'Courier New', monospace;
            line-height: 1.4;
            white-space: pre;
            overflow-x: auto;
            text-align: center;
            border: 1px solid var(--border-color);
            letter-spacing: 3px;
            tab-size: 4;
            font-size: 16px;
        }

        .structure-preview pre {
            margin: 0;
            font-family: 'Courier New', monospace;
            white-space: pre;
            letter-spacing: 3px;
            text-align: center;
            line-height: 1.4;
        }

        .explanation-box {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 25px;
            border-left: 4px solid var(--accent-color);
            margin-top: 25px;
        }

        .explanation-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            font-weight: 600;
            color: var(--text-color);
            font-size: 18px;
        }

        .explanation-content {
            color: var(--text-color);
            line-height: 1.7;
        }

        .error-section {
            background: rgba(231, 76, 60, 0.1);
            border: 2px solid #e74c3c;
            border-radius: 12px;
            padding: 30px;
            margin-top: 30px;
            grid-column: 1 / -1;
        }

        .error-section.hidden {
            display: none;
        }

        .error-section h3 {
            display: flex;
                align-items: center;
            gap: 10px;
            color: #e74c3c;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .error-section p {
            color: #e74c3c;
            margin: 0;
            line-height: 1.6;
        }

        .full-table {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            margin-top: 40px;
            overflow-x: auto;
            grid-column: 1 / -1;
        }

        .hydrocarbon-table {
            width: 100%;
            border-collapse: collapse;
        }

        .hydrocarbon-table thead {
            background: var(--table-header-bg);
        }

        .hydrocarbon-table th {
            padding: 18px 15px;
            text-align: left;
            font-weight: 600;
            color: var(--text-color);
            border-bottom: 2px solid var(--border-color);
        }

        .hydrocarbon-table td {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-color);
        }

        .hydrocarbon-table tr:hover {
            background: var(--table-hover-bg);
        }

        .combustion-equation {
            background: var(--code-bg);
            border-radius: 8px;
            padding: 20px;
            margin-top: 25px;
            font-family: 'Courier New', monospace;
            font-size: 20px;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .type-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .type-option {
            padding: 10px 20px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            color: var(--text-color);
        }

        .type-option:hover {
            border-color: var(--accent-color);
        }

        .type-option.active {
            border-color: var(--accent-color);
            background: var(--accent-color);
            color: white;
        }

        .advanced-options {
            background: var(--code-bg);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid var(--border-color);
        }

        .advanced-options.hidden {
            display: none;
        }

        .isomer-selector {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .isomer-option {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .isomer-option:hover {
            background: var(--accent-color);
            color: white;
        }

        .isomer-option.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .radical-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .radical-option {
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            text-align: center;
            font-size: 13px;
        }

        .radical-option:hover {
            background: var(--secondary-color);
            color: white;
        }

        .radical-option.active {
            background: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }
    </style>
</head>
<body>
    <div class="plugin-container">
        <header class="plugin-header">
            <div class="plugin-header-content">
                <a href="/" class="back-button">
                    <i class="fas fa-arrow-left"></i> Назад
                </a>
                <div class="plugin-title-section">
                    <img src="{{ config.site_logo_dark }}" class="header-logo plugin-logo" alt="logo">
                    <h1><i class="fas fa-atom"></i> Углеводороды: формулы и названия</h1>
                </div>
                <button id="themeToggle" class="theme-toggle"><i class="fas fa-moon"></i></button>
            </div>
        </header>

        <main class="main-content">
            <div class="info-section">
                <h2>Работа с углеводородами</h2>
                <p>Определение названий по формулам и генерация формул по параметрам.</p>
                <p>Используйте следующие форматы:</p>
                <code>C5H12</code> <code>C3H6</code> <code>C2H2</code>
            </div>

            <!-- Карточка 1: Определение названия по формуле -->
            <div class="form">
                <h2><i class="fas fa-search"></i> Определение названия по формуле</h2>

                <div class="form-group">
                    <label>Введите формулу углеводорода:</label>
                    <input type="text" id="formulaInput" class="form-control formula-input"
                           placeholder="C5H12" required>
                    <small>Формат: CxHy (например: C3H8, C4H8, C2H2)</small>

                    <div class="examples-grid">
                        <div class="example-tag" data-formula="CH4">CH4</div>
                        <div class="example-tag" data-formula="C2H6">C2H6</div>
                        <div class="example-tag" data-formula="C3H8">C3H8</div>
                        <div class="example-tag" data-formula="C4H10">C4H10</div>
                        <div class="example-tag" data-formula="C2H4">C2H4</div>
                        <div class="example-tag" data-formula="C3H6">C3H6</div>
                        <div class="example-tag" data-formula="C2H2">C2H2</div>
                        <div class="example-tag" data-formula="C6H6">C6H6</div>
                    </div>
                </div>

                <div class="advanced-options" id="advancedOptions">
                    <div class="form-group">
                        <label>Выберите изомер (для алкенов и алкинов):</label>
                        <div class="isomer-selector" id="isomerSelector">
                            <!-- Заполнится через JS -->
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Добавить радикал:</label>
                        <div class="radical-selector" id="radicalSelector">
                            <!-- Заполнится через JS -->
                        </div>
                    </div>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn-primary" onclick="analyzeFormula()">
                        <i class="fas fa-vial"></i> Анализировать формулу
                    </button>
                    <button type="button" class="btn-secondary" onclick="clearFormula()">
                        <i class="fas fa-broom"></i> Очистить
                    </button>
                </div>
            </div>

            <!-- Карточка 2: Генерация формулы -->
            <div class="form">
                <h2><i class="fas fa-calculator"></i> Генерация формулы</h2>

                <div class="form-group">
                    <label>Тип углеводорода:</label>
                    <div class="type-selector">
                        <div class="type-option active" data-type="alkane">Алканы</div>
                        <div class="type-option" data-type="alkene">Алкены</div>
                        <div class="type-option" data-type="alkyne">Алкины</div>
                        <div class="type-option" data-type="cycloalkane">Циклоалканы</div>
                        <div class="type-option" data-type="arena">Арены</div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Количество атомов углерода (n):</label>
                    <input type="number" id="carbonCount" class="form-control"
                           min="1" max="30" value="5" oninput="generateFormula()">
                    <small>Введите число от 1 до 30</small>
                </div>

                <div class="form-group" id="alkynePositionGroup" style="display: none;">
                    <label>Положение тройной связи (для алкинов):</label>
                    <select id="alkynePosition" class="form-control" onchange="generateFormula()">
                        <option value="1">1 (концевая)</option>
                        <option value="2">2 (внутренняя)</option>
                    </select>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn-primary" onclick="generateFormula()">
                        <i class="fas fa-cogs"></i> Сгенерировать формулу
                    </button>
                    <button type="button" class="btn-secondary" onclick="generateCombustionEquation()">
                        <i class="fas fa-fire"></i> Уравнение горения
                    </button>
                </div>
            </div>

            <!-- Результат анализа формулы -->
            <div id="formulaResult" class="result-section hidden">
                <h3><i class="fas fa-file-alt"></i> Результат анализа</h3>

                <div class="equation-card">
                    <div class="equation-number">1</div>
                    <div id="formulaDisplay" class="equation-display">
                        C₅H₁₂
                    </div>
                </div>

                <div class="formula-card">
                    <div class="formula-title">Класс углеводорода:</div>
                    <div id="hydrocarbonClass" class="hydrocarbon-class alkane">
                        Алкан
                    </div>
                </div>

                <div class="result-header">
                    <div class="result-item">
                        <div class="label">Название по ИЮПАК:</div>
                        <div class="value" id="iupacName">Пентан</div>
                    </div>

                    <div class="result-item">
                        <div class="label">Молекулярная формула:</div>
                        <div class="value" id="molecularFormula">C5H12</div>
                    </div>

                    <div class="result-item">
                        <div class="label">Общая формула:</div>
                        <div class="value" id="generalFormula">CnH2n+2</div>
                    </div>

                    <div class="result-item">
                        <div class="label">Молярная масса:</div>
                        <div class="value" id="molarMass">72.15 г/моль</div>
                    </div>
                </div>

                <div class="result-header" id="isomerInfo" style="display: none;">
                    <div class="result-item">
                        <div class="label">Тип изомера:</div>
                        <div class="value" id="isomerType">Нормальный</div>
                    </div>

                    <div class="result-item">
                        <div class="label">Положение связи:</div>
                        <div class="value" id="bondPosition">—</div>
                    </div>

                    <div class="result-item">
                        <div class="label">Радикалы:</div>
                        <div class="value" id="radicalsList">Нет</div>
                    </div>
                </div>

                <div id="structurePreview" class="structure-preview hidden">
                    <!-- Структурная формула будет вставлена через JS -->
                </div>

                <div class="explanation-box">
                    <div class="explanation-header"><i class="fas fa-lightbulb"></i> Объяснение</div>
                    <div class="explanation-content" id="formulaExplanation">
                        Формула C5H12 соответствует алканам (предельным углеводородам) с общей формулой CnH2n+2. При n=5 получаем пентан.
                    </div>
                </div>
            </div>

            <!-- Результат генерации формулы -->
            <div id="generationResult" class="result-section">
                <h3><i class="fas fa-magic"></i> Результат генерации</h3>

                <div class="equation-card">
                    <div class="equation-number">2</div>
                    <div id="generatedFormulaDisplay" class="equation-display">
                        C₅H₁₂
                    </div>
                </div>

                <div class="result-header">
                    <div class="result-item">
                        <div class="label">Тип углеводорода:</div>
                        <div class="value" id="generatedType">Алканы</div>
                    </div>

                    <div class="result-item">
                        <div class="label">Общая формула:</div>
                        <div class="value" id="generalFormulaDisplay">CnH2n+2</div>
                    </div>

                    <div class="result-item">
                        <div class="label">При n = <span id="nValue">5</span>:</div>
                        <div class="value" id="specificFormula">C5H12</div>
                    </div>

                    <div class="result-item">
                        <div class="label">Название:</div>
                        <div class="value" id="generatedName">Пентан</div>
                    </div>
                </div>

                <div id="combustionEquation" class="combustion-equation hidden">
                    C₅H₁₂ + 8O₂ → 5CO₂ + 6H₂O
                </div>

                <div class="explanation-box">
                    <div class="explanation-header"><i class="fas fa-lightbulb"></i> Информация</div>
                    <div class="explanation-content" id="generationExplanation">
                        Алканы - предельные углеводороды с общей формулой CnH2n+2. При n=5 получаем пентан.
                    </div>
                </div>
            </div>

            <!-- Ошибка -->
            <div id="formulaError" class="error-section hidden">
                <h3><i class="fas fa-exclamation-circle"></i> Ошибка</h3>
                <p id="formulaErrorMessage"></p>
            </div>

            <!-- Справочная таблица -->
            <div class="full-table">
                <h3><i class="fas fa-table"></i> Справочная информация</h3>

                <table class="hydrocarbon-table">
                    <thead>
                        <tr>
                            <th>Класс углеводородов</th>
                            <th>Общая формула</th>
                            <th>Пример</th>
                            <th>Название</th>
                            <th>Особенности</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Алканы</strong></td>
                            <td>C<sub>n</sub>H<sub>2n+2</sub></td>
                            <td>C<sub>4</sub>H<sub>10</sub></td>
                            <td>Бутан</td>
                            <td>Только одинарные связи, sp³-гибридизация</td>
                        </tr>
                        <tr>
                            <td><strong>Алкены</strong></td>
                            <td>C<sub>n</sub>H<sub>2n</sub></td>
                            <td>C<sub>3</sub>H<sub>6</sub></td>
                            <td>Пропен</td>
                            <td>Одна двойная связь, sp²-гибридизация</td>
                        </tr>
                        <tr>
                            <td><strong>Алкины</strong></td>
                            <td>C<sub>n</sub>H<sub>2n-2</sub></td>
                            <td>C<sub>2</sub>H<sub>2</sub></td>
                            <td>Этин (ацетилен)</td>
                            <td>Одна тройная связь, sp-гибридизация</td>
                        </tr>
                        <tr>
                            <td><strong>Циклоалканы</strong></td>
                            <td>C<sub>n</sub>H<sub>2n</sub></td>
                            <td>C<sub>6</sub>H<sub>12</sub></td>
                            <td>Циклогексан</td>
                            <td>Циклическое строение, напряжения цикла</td>
                        </tr>
                        <tr>
                            <td><strong>Арены</strong></td>
                            <td>C<sub>n</sub>H<sub>2n-6</sub></td>
                            <td>C<sub>6</sub>H<sub>6</sub></td>
                            <td>Бензол</td>
                            <td>Ароматичность, сопряжение π-электронов</td>
                        </tr>
                    </tbody>
                </table>

                <div style="margin-top: 30px;">
                    <h4><i class="fas fa-exclamation-triangle"></i> Важные замечания:</h4>
                    <ul style="padding-left: 20px; margin-top: 10px; line-height: 1.6;">
                        <li>Для алкинов с тройной связью в положении 1 (концевой) используется суффикс "-ин"</li>
                        <li>Для алкинов с внутренней тройной связью указывается номер атома углерода: бут-2-ин</li>
                        <li>Щелочные металлы (Li, Na, K) имеют степень окисления +1</li>
                        <li>Щелочноземельные металлы (Mg, Ca) имеют степень окисления +2</li>
                        <li>Для реакций вытеснения необходимо учитывать стехиометрические коэффициенты</li>
                    </ul>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Данные по углеводородам
        const hydrocarbonData = {
            alkane: { formula: "CnH2n+2", name: "Алканы", class: "alkane" },
            alkene: { formula: "CnH2n", name: "Алкены", class: "alkene" },
            alkyne: { formula: "CnH2n-2", name: "Алкины", class: "alkyne" },
            cycloalkane: { formula: "CnH2n", name: "Циклоалканы", class: "cyclo" },
            arena: { formula: "CnH2n-6", name: "Арены", class: "arena" }
        };

        // Радикалы
        const radicals = [
            { name: "Метил", formula: "CH3-", carbonCount: 1 },
            { name: "Этил", formula: "C2H5-", carbonCount: 2 },
            { name: "Пропил", formula: "C3H7-", carbonCount: 3 },
            { name: "Бутил", formula: "C4H9-", carbonCount: 4 },
            { name: "Фенил", formula: "C6H5-", carbonCount: 6 },
            { name: "Винил", formula: "CH2=CH-", carbonCount: 2 }
        ];

        // Изомеры для алкенов и алкинов
        const isomers = {
            alkene: [
                { name: "α-изомер (1-алкен)", position: 1 },
                { name: "β-изомер (2-алкен)", position: 2 },
                { name: "цис-изомер", type: "cis" },
                { name: "транс-изомер", type: "trans" }
            ],
            alkyne: [
                { name: "Концевой (1-алкин)", position: 1 },
                { name: "Внутренний (2-алкин)", position: 2 }
            ]
        };

        // Префиксы для названий
        const prefixes = ["", "Мет", "Эт", "Проп", "Бут", "Пент", "Гекс", "Гепт", "Окт", "Нон", "Дек",
                         "Ундек", "Додек", "Тридек", "Тетрадек", "Пентадек"];

        // Текущий выбранный радикал
        let selectedRadical = null;
        let selectedIsomer = null;

        // Инициализация
        document.addEventListener("DOMContentLoaded", () => {
            initTheme();
            initExamples();
            initTypeSelector();
            initRadicalSelector();
            generateFormula();
        });

        function initTheme() {
            const btn = document.getElementById("themeToggle");
            const saved = localStorage.getItem("theme") || "light";
            document.documentElement.setAttribute("data-theme", saved);

            btn.innerHTML = saved === "light" ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';

            btn.addEventListener("click", () => {
                const current = document.documentElement.getAttribute("data-theme");
                const next = current === "light" ? "dark" : "light";
                document.documentElement.setAttribute("data-theme", next);
                localStorage.setItem("theme", next);
                btn.innerHTML = next === "light" ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
            });
        }

        function initExamples() {
            document.querySelectorAll('.example-tag').forEach(tag => {
                tag.addEventListener('click', () => {
                    const formula = tag.getAttribute('data-formula');
                    document.getElementById('formulaInput').value = formula;

                    // Подсветка активного тега
                    document.querySelectorAll('.example-tag').forEach(t => t.classList.remove('active'));
                    tag.classList.add('active');

                    analyzeFormula();
                });
            });
        }

        function initTypeSelector() {
            document.querySelectorAll('.type-option').forEach(option => {
                option.addEventListener('click', () => {
                    const type = option.getAttribute('data-type');

                    // Подсветка активной опции
                    document.querySelectorAll('.type-option').forEach(o => o.classList.remove('active'));
                    option.classList.add('active');

                    // Показываем/скрываем дополнительные опции
                    const alkyneGroup = document.getElementById('alkynePositionGroup');
                    if (type === 'alkyne') {
                        alkyneGroup.style.display = 'block';
                    } else {
                        alkyneGroup.style.display = 'none';
                    }

                    generateFormula();
                });
            });
        }

        function initRadicalSelector() {
            const container = document.getElementById('radicalSelector');
            container.innerHTML = '';

            radicals.forEach((radical, index) => {
                const div = document.createElement('div');
                div.className = 'radical-option';
                div.textContent = radical.name;
                div.setAttribute('data-index', index);

                div.addEventListener('click', () => {
                    selectedRadical = radical;
                    document.querySelectorAll('.radical-option').forEach(o => o.classList.remove('active'));
                    div.classList.add('active');
                });

                container.appendChild(div);
            });
        }

        function clearFormula() {
            document.getElementById('formulaInput').value = '';
            document.getElementById('formulaResult').classList.add('hidden');
            document.getElementById('formulaError').classList.add('hidden');
            document.querySelectorAll('.example-tag').forEach(t => t.classList.remove('active'));

            // Сбрасываем радикалы
            selectedRadical = null;
            document.querySelectorAll('.radical-option').forEach(o => o.classList.remove('active'));
        }

        // Анализ введенной формулы
        function analyzeFormula() {
            const input = document.getElementById("formulaInput").value.trim().toUpperCase();

            if (!input) {
                showFormulaError("Введите формулу углеводорода");
                return;
            }

            // Парсим формулу
            const formulaMatch = input.match(/^C(\d+)H(\d+)$/);
            if (!formulaMatch) {
                showFormulaError("Неверный формат формулы. Используйте формат: CxHy (например, C5H12)");
                return;
            }

            const cCount = parseInt(formulaMatch[1]);
            const hCount = parseInt(formulaMatch[2]);

            if (cCount < 1 || cCount > 50 || hCount < 2 || hCount > 200) {
                showFormulaError("Некорректное количество атомов");
                return;
            }

            // Определяем тип углеводорода
            let type = "";
            let className = "";
            let generalFormula = "";
            let isomerType = "Нормальный";
            let bondPosition = "—";

            // Проверяем все возможные формулы
            if (hCount === 2 * cCount + 2) {
                type = "Алканы";
                className = "alkane";
                generalFormula = "C<sub>n</sub>H<sub>2n+2</sub>";
            } else if (hCount === 2 * cCount) {
                // Может быть алкен или циклоалкан
                if (cCount >= 3) {
                    type = "Алкены или Циклоалканы";
                    className = "alkene";
                    generalFormula = "C<sub>n</sub>H<sub>2n</sub>";
                    isomerType = "Возможна цис-транс изомерия";
                    bondPosition = "1";
                } else {
                    type = "Алкены";
                    className = "alkene";
                    generalFormula = "C<sub>n</sub>H<sub>2n</sub>";
                }
            } else if (hCount === 2 * cCount - 2) {
                type = "Алкины";
                className = "alkyne";
                generalFormula = "C<sub>n</sub>H<sub>2n-2</sub>";

                // Для алкинов больше 3 атомов углерода определяем положение связи
                if (cCount >= 4) {
                    bondPosition = "1 или 2";
                    isomerType = "Концевой или внутренний";
                } else {
                    bondPosition = "1";
                }
            } else if (hCount === 2 * cCount - 6 && cCount >= 6) {
                type = "Арены";
                className = "arena";
                generalFormula = "C<sub>n</sub>H<sub>2n-6</sub>";
            } else {
                type = "Неизвестный тип или производное";
                className = "";
                generalFormula = "—";
            }

            // Генерируем название с учетом изомеров
            const name = generateName(cCount, type, bondPosition);

            // Рассчитываем молярную массу
            const molarMass = (12.01 * cCount + 1.008 * hCount).toFixed(2);

            // Отображаем результаты
            document.getElementById("formulaError").classList.add("hidden");
            document.getElementById("formulaResult").classList.remove("hidden");

            // Обновляем класс углеводорода
            const classElement = document.getElementById("hydrocarbonClass");
            classElement.textContent = type.split(" или ")[0];
            classElement.className = `hydrocarbon-class ${className}`;

            // Форматируем формулу
            const formattedFormula = formatFormula(input);
            document.getElementById("formulaDisplay").innerHTML = formattedFormula;

            // Заполняем данные
            document.getElementById("iupacName").textContent = name;
            document.getElementById("molecularFormula").textContent = input;
            document.getElementById("generalFormula").innerHTML = generalFormula;
            document.getElementById("molarMass").textContent = `${molarMass} г/моль`;

            // Показываем информацию об изомерах для алкенов и алкинов
            const isomerInfo = document.getElementById("isomerInfo");
            if (type.includes("Алкен") || type.includes("Алкин")) {
                document.getElementById("isomerType").textContent = isomerType;
                document.getElementById("bondPosition").textContent = bondPosition;
                document.getElementById("radicalsList").textContent = selectedRadical ? selectedRadical.name : "Нет";
                isomerInfo.style.display = "grid";
            } else {
                isomerInfo.style.display = "none";
            }

            // Объяснение
            let explanation = `Формула ${input} соответствует ${type.toLowerCase()}`;
            if (className === "alkane") explanation += " (предельные углеводороды)";
            else if (className === "alkene") explanation += " (непредельные углеводороды с двойной связью)";
            else if (className === "alkyne") explanation += " (непредельные углеводороды с тройной связью)";
            else if (className === "arena") explanation += " (ароматические углеводороды)";

            explanation += ` с общей формулой ${generalFormula}. При n=${cCount} получаем ${name}.`;

            if (type.includes("Алкен") && cCount >= 4) {
                explanation += " Для алкенов с 4+ атомами углерода возможна цис-транс изомерия.";
            }

            if (type.includes("Алкин") && cCount >= 4) {
                explanation += " Для алкинов с 4+ атомами углерода возможны изомеры положения тройной связи.";
            }

            if (selectedRadical) {
                explanation += ` Содержит радикал ${selectedRadical.name}.`;
            }

            document.getElementById("formulaExplanation").innerHTML = explanation;

            // Структурная формула
            const structurePreview = document.getElementById("structurePreview");

            if (className === "alkane" && cCount >= 1 && cCount <= 8 && !type.includes("Цикло")) {
                const structure = generateAlkaneStructure(cCount);
                structurePreview.innerHTML = `<pre>${structure}</pre>`;
                structurePreview.classList.remove("hidden");
            } else if (className === "cyclo" && cCount >= 3 && cCount <= 6) {
                const structure = generateCycloalkaneStructure(cCount);
                structurePreview.innerHTML = `<pre>${structure}</pre>`;
                structurePreview.classList.remove("hidden");
            } else {
                structurePreview.classList.add("hidden");
            }
        }

        // Генерация формулы
        function generateFormula() {
            const activeType = document.querySelector('.type-option.active').getAttribute('data-type');
            const n = parseInt(document.getElementById("carbonCount").value) || 1;
            const alkynePosition = document.getElementById("alkynePosition").value;

            const typeData = hydrocarbonData[activeType];
            let hCount = 0;

            // Вычисляем количество водородов
            if (activeType === "alkane") {
                hCount = 2 * n + 2;
            } else if (activeType === "alkene" || activeType === "cycloalkane") {
                hCount = 2 * n;
            } else if (activeType === "alkyne") {
                hCount = 2 * n - 2;
            } else if (activeType === "arena") {
                hCount = 2 * n - 6;
                if (hCount < 1) hCount = 6; // минимум для бензола
            }

            // Формируем формулы
            const specificFormula = `C${n}H${hCount}`;
            const generalFormula = typeData.formula;

            // Генерируем название с учетом особенностей
            let name = generateName(n, typeData.name, alkynePosition);

            // Для алкинов добавляем положение связи
            if (activeType === "alkyne" && n >= 4) {
                if (alkynePosition === "1") {
                    name = name.replace("ин", "-1-ин");
                } else {
                    name = name.replace("ин", "-2-ин");
                }
            }

            // Рассчитываем молярную массу
            const molarMass = (12.01 * n + 1.008 * hCount).toFixed(2);

            // Отображаем результаты
            document.getElementById("nValue").textContent = n;
            document.getElementById("generatedType").textContent = typeData.name;
            document.getElementById("generalFormulaDisplay").innerHTML = generalFormula;
            document.getElementById("specificFormula").textContent = specificFormula;
            document.getElementById("generatedName").textContent = name;

            // Форматируем формулу
            const formattedFormula = formatFormula(specificFormula);
            document.getElementById("generatedFormulaDisplay").innerHTML = formattedFormula;

            // Объяснение
            let explanation = `${typeData.name} - `;
            if (activeType === "alkane") {
                explanation += "предельные углеводороды с одинарными связями, sp³-гибридизация. ";
            } else if (activeType === "alkene") {
                explanation += "непредельные углеводороды с одной двойной связью, sp²-гибридизация. ";
                if (n >= 4) explanation += "Возможна цис-транс изомерия. ";
            } else if (activeType === "alkyne") {
                explanation += "непредельные углеводороды с одной тройной связью, sp-гибридизация. ";
                if (n >= 4) {
                    explanation += alkynePosition === "1"
                        ? "Тройная связь концевая (положение 1). "
                        : "Тройная связь внутренняя (положение 2). ";
                }
            } else if (activeType === "cycloalkane") {
                explanation += "циклические предельные углеводороды. ";
                if (n === 3) explanation += "Циклопропан имеет большое напряжение цикла. ";
                if (n === 6) explanation += "Циклогексан существует в форме 'кресла' и 'ванны'. ";
            } else if (activeType === "arena") {
                explanation += "ароматические углеводороды с системой сопряженных π-электронов. ";
                if (n === 6) explanation += "Бензол имеет делокализованные π-электроны. ";
            }

            explanation += `Общая формула: ${generalFormula}. При n=${n} получаем ${name} (${specificFormula}).`;

            document.getElementById("generationExplanation").innerHTML = explanation;

            // Скрываем уравнение горения
            document.getElementById("combustionEquation").classList.add("hidden");
        }

        // Генерация уравнения горения
        function generateCombustionEquation() {
            const activeType = document.querySelector('.type-option.active').getAttribute('data-type');
            const n = parseInt(document.getElementById("carbonCount").value) || 1;

            let hCount = 0;

            if (activeType === "alkane") {
                hCount = 2 * n + 2;
            } else if (activeType === "alkene" || activeType === "cycloalkane") {
                hCount = 2 * n;
            } else if (activeType === "alkyne") {
                hCount = 2 * n - 2;
            } else if (activeType === "arena") {
                hCount = 2 * n - 6;
                if (hCount < 1) hCount = 6;
            }

            // Уравнение горения: CxHy + (x + y/4)O2 → xCO2 + (y/2)H2O
            const o2Coefficient = n + hCount / 4;
            const co2Coefficient = n;
            const h2oCoefficient = hCount / 2;

            // Форматируем коэффициенты
            let multiplier = 1;
            if (o2Coefficient % 1 !== 0) multiplier = 4;
            if (h2oCoefficient % 1 !== 0) multiplier = 2;

            const formattedO2 = Math.round(o2Coefficient * multiplier);
            const formattedCO2 = Math.round(co2Coefficient * multiplier);
            const formattedH2O = Math.round(h2oCoefficient * multiplier);

            // Форматируем формулу углеводорода
            const formattedHydrocarbon = formatFormula(`C${n}H${hCount}`);

            // Формируем уравнение
            let equation = `${formattedHydrocarbon} + ${formattedO2}O₂ → ${formattedCO2}CO₂ + ${formattedH2O}H₂O`;

            // Если есть множитель, показываем примечание
            if (multiplier > 1) {
                equation += ` (все коэффициенты умножены на ${multiplier})`;
            }

            // Отображаем уравнение
            const combustionElement = document.getElementById("combustionEquation");
            combustionElement.innerHTML = equation;
            combustionElement.classList.remove("hidden");
        }

        // ФУНКЦИИ ГЕНЕРАЦИИ СТРУКТУРНЫХ ФОРМУЛ - ИСПРАВЛЕННЫЕ
        function generateAlkaneStructure(cCount) {
            if (cCount === 1) {
                return "   H\n   |\n H-C-H\n   |\n   H";
            }

            if (cCount > 12) {
                return `C${cCount}H${2*cCount+2}\n(слишком длинная цепь для отображения)`;
            }

            // Строим структуру
            let structure = "";

            // Верхние H
            for (let i = 0; i < cCount; i++) {
                structure += "H   ";
            }
            structure = structure.trimEnd() + "\n";

            // Вертикальные связи
            for (let i = 0; i < cCount; i++) {
                structure += "|   ";
            }
            structure = structure.trimEnd() + "\n";

            // Углеродная цепь
            structure += "H-";
            for (let i = 0; i < cCount; i++) {
                structure += "C";
                if (i < cCount - 1) structure += "-";
            }
            structure += "-H\n";

            // Вертикальные связи
            for (let i = 0; i < cCount; i++) {
                structure += "|   ";
            }
            structure = structure.trimEnd() + "\n";

            // Нижние H
            for (let i = 0; i < cCount; i++) {
                structure += "H   ";
            }

            return structure.trimEnd();
        }

        function generateCycloalkaneStructure(cCount) {
            switch(cCount) {
                case 3:
                    return "  H   H\n   \\ /\n  C-C-C\n  |   |\n  H   H";
                case 4:
                    return "H   H\n \\ /\n  C-C\n /   \\\nC     C\n \\   /\n  H H";
                case 5:
                    return "    H\n     \\\n      C\n     / \\\n    C   C\n    |   |\n    C   C\n     \\ /\n      H";
                case 6:
                    return "    H   H\n     \\ /\n  H-C   C-H\n   |     |\n  H-C   C-H\n     / \\\n    H   H";
                default:
                    return `C${cCount}H${2*cCount}\n(циклическая структура)`;
            }
        }

        // Вспомогательные функции
        function generateName(cCount, type, position = "1") {
            if (cCount === 0) return "—";

            let prefix = "";
            if (cCount < prefixes.length) {
                prefix = prefixes[cCount];
            } else {
                prefix = prefixes[prefixes.length - 1];
            }

            if (type.includes("Алкан")) {
                return prefix + "ан";
            } else if (type.includes("Алкен")) {
                return prefix + "ен";
            } else if (type.includes("Алкин")) {
                // Для алкинов
                if (cCount === 2) return "Этин (ацетилен)";
                return prefix + "ин";
            } else if (type.includes("Циклоалкан")) {
                return "Цикло" + prefix.toLowerCase() + "ан";
            } else if (type.includes("Арены")) {
                if (cCount === 6) return "Бензол";
                if (cCount === 7) return "Толуол (метилбензол)";
                if (cCount === 8) return "Этилбензол";
                return prefix.toLowerCase() + "илбензол";
            }

            return prefix + "ан";
        }

        function formatFormula(formula) {
            return formula.replace(/(\d+)/g, (match) => {
                const subscripts = {"0": "₀", "1": "₁", "2": "₂", "3": "₃", "4": "₄",
                                   "5": "₅", "6": "₆", "7": "₇", "8": "₈", "9": "₉"};
                return match.split('').map(digit => subscripts[digit]).join('');
            });
        }

        function showFormulaError(message) {
            document.getElementById("formulaResult").classList.add("hidden");
            document.getElementById("formulaError").classList.remove("hidden");
            document.getElementById("formulaErrorMessage").textContent = message;
        }

        // Функция для исправления электрохимического ряда (для металлов с зарядом +1)
        function getMetalCharge(symbol) {
            const plus1Metals = ["LI", "NA", "K", "RB", "CS", "FR"];
            const plus2Metals = ["MG", "CA", "SR", "BA", "RA", "ZN", "CD", "HG"];
            const plus3Metals = ["AL", "GA", "IN", "TL"];

            if (plus1Metals.includes(symbol.toUpperCase())) return 1;
            if (plus2Metals.includes(symbol.toUpperCase())) return 2;
            if (plus3Metals.includes(symbol.toUpperCase())) return 3;

            // По умолчанию для переходных металлов
            return 2;
        }

        // Правильное уравнение реакции с учетом зарядов
        function getReactionEquation(active, lessActive) {
            const charge1 = getMetalCharge(active.symbol);
            const charge2 = getMetalCharge(lessActive.symbol);

            if (charge1 === 1 && charge2 === 1) {
                return `${active.symbol} + ${lessActive.symbol}⁺ → ${active.symbol}⁺ + ${lessActive.symbol}`;
            } else if (charge1 === 1 && charge2 === 2) {
                return `2${active.symbol} + ${lessActive.symbol}²⁺ → 2${active.symbol}⁺ + ${lessActive.symbol}`;
            } else if (charge1 === 2 && charge2 === 1) {
                return `${active.symbol} + 2${lessActive.symbol}⁺ → ${active.symbol}²⁺ + 2${lessActive.symbol}`;
            } else {
                return `${active.symbol} + ${lessActive.symbol}²⁺ → ${active.symbol}²⁺ + ${lessActive.symbol}`;
            }
        }
    </script>
{% endblock %}